"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var isType=require("is_js"),Configula=function(){function t(){this._conf={},this._type={},this.__issues=[]}return t.prototype.clear=function(){return this._type={},this.empty()},t.prototype.empty=function(){return this._conf={},this},t.prototype.has=function(t){return void 0!==this.read(t)},t.prototype.read=function(t){return this._getPath(this._conf,this._steps(this.__parsePath(t)))},t.prototype.write=function(t,e){return this.__traverse(t,e,"write")},t.prototype.define=function(t,e){return this.__traverse(t,e,"define")},t.prototype.__traverse=function(t,e,s){if(this.__isNestingObject(e))for(var i in e){var r=t?isType.array(e)?t+"["+i+"]":t+"."+i:""+i;this.__traverse(r,e[i],s)}else{this["_"+s](t,e)}return this},t.prototype._write=function(t,e){var s=this._steps(this.__parsePathGlobIndex(t)),i=s.pop(),r=this._getPath(this._type,s);if(isType.undefined(e))return this.__issues.push(s.join(".")+" will not accept undefined as a value."),this;if(isType.object(e)||isType.array(e))return this;if(!r)return this.__issues.push(s.join(".")+" is invalid."),this;var n=r[i];if(!n)return this.__issues.push(t+" is invalid at "+JSON.stringify(i)+"."),this;if(!this._isPermitted(n,e))return this.__issues.push(t+" matches an invalid type at "+JSON.stringify(n)+"."),this;var o=this._steps(this.__parsePath(t)),p=o.pop();return this._createPath(this._conf,o)[p]=e,this},t.prototype._define=function(t,e,s){var i=this._steps(this.__parsePathGlobIndex(t)),r=i.pop();return this._createPath(this._type,i)[r]=e,this},t.prototype._isPermitted=function(t,e){return"function"==typeof t?t(e,isType,this):"string"==typeof t&&isType[t].call(isType,e)},t.prototype._getPath=function(t,e){var s=t;if(s){for(var i in e){var r=e[i];if(this.__isNumericStep(r)&&(r=r.substr(0,r.length-1)),!s[r])return;s=s[r]}return s}},t.prototype._createPath=function(t,e){var s=t;if(s){for(var i in e){var r=e[i],n=this.__isNumericStep(r);n&&(r=r.substr(0,r.length-1)),s[r]||(s[r]=n?[]:{}),s=s[r]}return s}},t.prototype.isOk=function(){return this.__issues.length>0},t.prototype.issues=function(){var t=this.__cloneIssues();return this.__clearIssues(),new Promise(function(e,s){t.length>0?s(t):e()})},t.prototype.__cloneIssues=function(){return this.__issues.slice(0)},t.prototype.__clearIssues=function(){return this.__issues=[],this},t.prototype._steps=function(t){return t.split(".")},t.prototype.__parsePath=function(t){return t.replace("[","!.").replace("]","")},t.prototype.__parsePathGlobIndex=function(t){var e=t.replace(/\[([^\]]+)\]/g,"[0]");return this.__parsePath(e)},t.prototype.__isNumericStep=function(t){return!!t&&"!"===t[t.length-1]},t.prototype.__isNestingObject=function(t){return isType.array(t)||isType.object(t)&&"Object"===t.constructor.name},t}();exports.Configula=Configula;