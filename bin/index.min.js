"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var isType=require("is_js"),Configuration=function(){function t(){this._conf={},this._type={}}return t.prototype.clear=function(){return this._type={},this.empty()},t.prototype.empty=function(){return this._conf={},this},t.prototype.has=function(t){return void 0!==this.read(t)},t.prototype.read=function(t){return this._getPath(this._conf,this._steps(this.__parsePath(t)))},t.prototype.write=function(t,e){var r=this.__trackIssues();return this.__traverse(t,e,"write",r),this.__reportIssues(r)},t.prototype.define=function(t,e){var r=this.__trackIssues();return this.__traverse(t,e,"define",r),this.__reportIssues(r)},t.prototype.__traverse=function(t,e,r,i){if(this.__isNestingObject(e))for(var s in e){var n=isType.array(e)?t+"["+s+"]":t+"."+s;this.__traverse(n,e[s],r,i)}else{this["_"+r](t,e,i)}},t.prototype._write=function(t,e,r){var i=this._steps(this.__parsePathGlobIndex(t)),s=i.pop(),n=this._getPath(this._type,i);if(isType.object(e)||isType.array(e))return this;if(!n)return r.push(i.join(".")+" is invalid."),this;var o=n[s];if(!o)return r.push(t+" is invalid at "+JSON.stringify(s)+"."),this;if(!this._isPermitted(o,e))return r.push(t+" matches an invalid type at "+JSON.stringify(o)+"."),this;var p=this._steps(this.__parsePath(t)),a=p.pop();return this._createPath(this._conf,p)[a]=e,this},t.prototype._define=function(t,e,r){var i=this._steps(this.__parsePathGlobIndex(t)),s=i.pop();return this._createPath(this._type,i)[s]=e,this},t.prototype._isPermitted=function(t,e){return"function"==typeof t?t(e,isType,this):"string"==typeof t&&isType[t].call(isType,e)},t.prototype._getPath=function(t,e){var r=t;if(r){for(var i in e){var s=e[i];if(this.__isNumericStep(s)&&(s=s.substr(0,s.length-1)),!r[s])return;r=r[s]}return r}},t.prototype._createPath=function(t,e){var r=t;if(r){for(var i in e){var s=e[i],n=this.__isNumericStep(s);n&&(s=s.substr(0,s.length-1)),r[s]||(r[s]=n?[]:{}),r=r[s]}return r}},t.prototype.__trackIssues=function(){return[]},t.prototype.__reportIssues=function(t){return new Promise(function(e,r){t.length>0?r(t):e()})},t.prototype._steps=function(t){return t.split(".")},t.prototype.__parsePath=function(t){return t.replace("[","!.").replace("]","")},t.prototype.__parsePathGlobIndex=function(t){var e=t.replace(/\[([^\]]+)\]/g,"[0]");return this.__parsePath(e)},t.prototype.__isNumericStep=function(t){return!!t&&"!"===t[t.length-1]},t.prototype.__isNestingObject=function(t){return isType.array(t)||isType.object(t)&&"Object"===t.constructor.name},t}();exports.Configuration=Configuration;